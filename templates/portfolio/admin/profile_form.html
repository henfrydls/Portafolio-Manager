{% extends "portfolio/admin/base_admin.html" %}

{% load static %}
{% load i18n %}



{% block admin_title %}{% trans "My Profile" %}{% endblock %}

{% block admin_subtitle %}{% trans "Update your personal and professional information." %}{% endblock %}



{% block admin_actions %}

<a href="{% url 'portfolio:admin-dashboard' %}" class="btn-secondary-custom">

    <i class="fas fa-arrow-left"></i>{% trans "Back to Dashboard" %}

</a>

{% endblock %}



{% block admin_content %}

<div style="max-width: 1200px; margin: 0 auto;">

    {% include "portfolio/admin/includes/auto_translation_status.html" %}

    <div class="content-card">

        <div class="card-header-custom">

            <div>

                <h2 class="card-title-custom">{% trans "Personal Information" %}</h2>

                <p class="card-subtitle-custom">{% trans "Update your public profile information." %}</p>

            </div>

        </div>

        
        
        {% include "portfolio/admin/includes/editing_language_notice.html" %}

        <form method="post" enctype="multipart/form-data">

            {% csrf_token %}

            

            <!-- Form-wide error alert (compact style) -->

            {% if form.errors %}

            <div class="alert alert-error" style="background: #FFEBEE; border-left: 4px solid #dc3545; padding: 12px 16px; border-radius: 6px; margin-bottom: 24px; display: flex; align-items: center; gap: 12px;">

                <i class="fas fa-exclamation-circle" style="color: #dc3545; font-size: 16px;"></i>

                <span style="font-size: 13px; color: #D32F2F; font-weight: 500;">{% trans "There was an error updating the profile. Please review the fields." %}</span>

            </div>

            {% endif %}

            

            <!-- Basic Information -->

            <div style="margin-bottom: 32px;">

                <h3 style="font-size: 18px; font-weight: 600; color: #242424; margin-bottom: 16px;">{% trans "Basic Information" %}</h3>

                

                <div style="margin-bottom: 20px;">

                    <label for="{{ form.name.id_for_label }}" class="form-label-custom">

                        {{ form.name.label }} <span style="color: #dc3545;">*</span>

                    </label>

                    {{ form.name }}

                    {% if form.name.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.name.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.title.id_for_label }}" class="form-label-custom">

                        {{ form.title.label }} <span style="color: #dc3545;">*</span>

                    </label>

                    {{ form.title }}

                    {% if form.title.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.title.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.bio.id_for_label }}" class="form-label-custom">

                        {{ form.bio.label }} <span style="color: #dc3545;">*</span>

                    </label>

                    {{ form.bio }}

                    {% if form.bio.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.bio.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.profile_image.id_for_label }}" class="form-label-custom">

                        {{ form.profile_image.label }}

                    </label>

                    {{ form.profile_image }}

                    {% if form.profile_image.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.profile_image.errors.0 }}</div>

                    {% endif %}

                    {% if object.profile_image %}

                        <div style="margin-top: 12px;">

                            <small style="color: #6B6B6B;">{% trans "Current image:" %}</small><br>

                            <img src="{{ object.profile_image.url }}" alt="{{ object.name }}" 

                                 style="width: 100px; height: 100px; object-fit: cover; border-radius: 50%; margin-top: 8px;">

                        </div>

                    {% endif %}

                </div>

            </div>



            <!-- Contact Information -->

            <div style="margin-bottom: 32px;">

                <h3 style="font-size: 18px; font-weight: 600; color: #242424; margin-bottom: 16px;">{% trans "Contact Information" %}</h3>

                

                <div style="margin-bottom: 20px;">

                    <label for="{{ form.email.id_for_label }}" class="form-label-custom">

                        {{ form.email.label }} <span style="color: #dc3545;">*</span>

                    </label>

                    {{ form.email }}

                    {% if form.email.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.email.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.phone.id_for_label }}" class="form-label-custom">

                        {{ form.phone.label }}

                    </label>

                    {{ form.phone }}

                    {% if form.phone.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.phone.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.location.id_for_label }}" class="form-label-custom">

                        {{ form.location.label }}

                    </label>

                    {{ form.location }}

                    {% if form.location.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.location.errors.0 }}</div>

                    {% endif %}

                </div>

            </div>



            <!-- Social Links -->

            <div style="margin-bottom: 32px;">

                <h3 style="font-size: 18px; font-weight: 600; color: #242424; margin-bottom: 16px;">{% trans "Social Links" %}</h3>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.linkedin_url.id_for_label }}" class="form-label-custom">

                        {{ form.linkedin_url.label }}

                    </label>

                    {{ form.linkedin_url }}

                    {% if form.linkedin_url.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.linkedin_url.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.github_url.id_for_label }}" class="form-label-custom">

                        {{ form.github_url.label }}

                    </label>

                    {{ form.github_url }}

                    {% if form.github_url.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.github_url.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.medium_url.id_for_label }}" class="form-label-custom">

                        {{ form.medium_url.label }}

                    </label>

                    {{ form.medium_url }}

                    {% if form.medium_url.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.medium_url.errors.0 }}</div>

                    {% endif %}

                </div>

            </div>



            <!-- Resume Settings -->

            <div style="margin-bottom: 32px;">

                <h3 style="font-size: 18px; font-weight: 600; color: #242424; margin-bottom: 16px;">{% trans "CV Settings" %}</h3>

                

                <div style="margin-bottom: 20px;">

                    <label for="{{ form.resume_pdf.id_for_label }}" class="form-label-custom">

                        {{ form.resume_pdf.label }}

                    </label>

                    {{ form.resume_pdf }}

                    {% if form.resume_pdf.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.resume_pdf.errors.0 }}</div>

                    {% endif %}

                    {% if object.resume_pdf %}

                        <div style="margin-top: 8px; display: flex; align-items: center; gap: 12px;">

                            <div>

                                <small style="color: #6B6B6B;">{% trans "Current file:" %}</small>

                                <a href="{{ object.resume_pdf.url }}" target="_blank" style="color: #1976D2; text-decoration: none; margin-left: 8px;">

                                    <i class="fas fa-file-pdf"></i> {% trans "View English CV" %}

                                </a>

                            </div>

                            <button type="button" id="delete-resume-btn"

                                    style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 4px;">

                                <i class="fas fa-trash"></i> {% trans "Delete" %}

                            </button>

                        </div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <label for="{{ form.resume_pdf_es.id_for_label }}" class="form-label-custom">

                        {{ form.resume_pdf_es.label }}

                    </label>

                    {{ form.resume_pdf_es }}

                    {% if form.resume_pdf_es.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.resume_pdf_es.errors.0 }}</div>

                    {% endif %}

                    {% if object.resume_pdf_es %}

                        <div style="margin-top: 8px; display: flex; align-items: center; gap: 12px;">

                            <div>

                                <small style="color: #6B6B6B;">{% trans "Current file:" %}</small>

                                <a href="{{ object.resume_pdf_es.url }}" target="_blank" style="color: #1976D2; text-decoration: none; margin-left: 8px;">

                                    <i class="fas fa-file-pdf"></i> {% trans "View Spanish CV" %}

                                </a>

                            </div>

                            <button type="button" id="delete-resume-es-btn"

                                    style="background: #dc3545; color: white; border: none; padding: 6px 12px; border-radius: 4px; font-size: 12px; cursor: pointer; display: flex; align-items: center; gap: 4px;">

                                <i class="fas fa-trash"></i> {% trans "Delete" %}

                            </button>

                        </div>

                    {% endif %}

                </div>



                <div style="margin-bottom: 20px;">

                    <div style="display: flex; align-items: center; gap: 8px;">

                        {{ form.show_web_resume }}

                        <label for="{{ form.show_web_resume.id_for_label }}" class="form-label-custom" style="margin-bottom: 0;">

                            {{ form.show_web_resume.label }}

                        </label>

                    </div>

                    {% if form.show_web_resume.errors %}

                        <div style="color: #dc3545; font-size: 12px; margin-top: 4px;">{{ form.show_web_resume.errors.0 }}</div>

                    {% endif %}

                </div>



                <div style="background: #FFF3CD; padding: 12px; border-radius: 6px; border-left: 4px solid #FFC107; margin-top: 16px;">

                    <p style="font-size: 13px; color: #856404; margin: 0;">

                        <i class="fas fa-info-circle" style="margin-right: 4px;"></i>

                        <strong>{% trans "Note:" %}</strong> {% trans "The system automatically detects the user's language and displays the corresponding CV. If you only have one CV, it will be shown regardless of the language." %}

                    </p>

                </div>

            </div>



            <div style="display: flex; justify-content: space-between; align-items: center; padding-top: 24px; border-top: 1px solid #F2F2F2;">

                <a href="{% url 'portfolio:admin-dashboard' %}" class="btn-secondary-custom">

                    <i class="fas fa-times"></i>{% trans "Cancel" %}

                </a>

                <button type="submit" class="btn-primary-custom" id="save-profile-btn">

                    <i class="fas fa-save"></i>{% trans "Save Changes" %}

                </button>

            </div>

        </form>

    </div>

</div>

{% endblock %}



{% block extra_js %}

{{ block.super }}

<script>
document.addEventListener('DOMContentLoaded', function() {
    const formFields = document.querySelectorAll('input[type="text"], input[type="email"], input[type="url"], textarea, select');
    formFields.forEach(field => {
        if (!field.classList.contains('form-check-input')) {
            field.classList.add('form-control-custom');
        }
    });

    const fileInputs = document.querySelectorAll('input[type="file"]');
    fileInputs.forEach(input => {
        input.classList.add('form-control-custom');
    });

    const mainForm = document.querySelector('form[enctype="multipart/form-data"]');

    function addDeleteHandler(buttonId, fieldName, message) {
        const button = document.getElementById(buttonId);
        if (!button || !mainForm) {
            return;
        }

        button.addEventListener('click', function() {
            if (!confirm(message)) {
                return;
            }

            const hiddenField = document.createElement('input');
            hiddenField.type = 'hidden';
            hiddenField.name = fieldName;
            hiddenField.value = 'true';
            mainForm.appendChild(hiddenField);
            mainForm.submit();
        });
    }

    addDeleteHandler(
        'delete-resume-btn',
        'delete_resume',
        '{% trans "Are you sure you want to delete the English CV? This action cannot be undone." %}'
    );

    addDeleteHandler(
        'delete-resume-es-btn',
        'delete_resume_es',
        '{% trans "Are you sure you want to delete the Spanish CV? This action cannot be undone." %}'
    );
});
</script>

{% endblock %}



