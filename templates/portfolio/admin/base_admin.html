{% extends "base.html" %}
{% load static %}
{% load simple_i18n %}

{% block title %}Admin - {{ block.super }}{% endblock %}

{% block extra_css %}
<style>
/* Base Styles - Consistent with blog design */
body {
    font-family: sohne, "Helvetica Neue", Helvetica, Arial, sans-serif;
    background: #fafafa;
    color: rgba(41, 41, 41, 1);
    line-height: 1.58;
    letter-spacing: -0.004em;
}

#portfolio-lang-switcher {
    display: none !important;
}

/* Top Navigation - Same as blog */
.admin-top-nav {
    position: sticky;
    top: 0;
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid #F2F2F2;
    z-index: 1000;
    padding: 0 20px;
}

.nav-container {
    max-width: 1192px;
    margin: 0 auto;
    display: flex;
    justify-content: space-between;
    align-items: center;
    height: 57px;
}

.nav-left {
    display: flex;
    align-items: center;
    gap: 12px;
}

.nav-right {
    display: flex;
    gap: 28px;
}

.nav-link {
    color: rgba(117, 117, 117, 1);
    text-decoration: none;
    font-size: 14px;
    font-weight: 400;
    transition: color 0.15s ease;
}

.nav-link:hover {
    color: #242424;
}

.nav-left .nav-link {
    font-size: 16px;
    font-weight: 600;
    color: #242424;
}

.nav-left .nav-link:hover {
    opacity: 0.7;
}

.nav-link.active {
    color: #242424 !important;
    font-weight: 500;
}

.lang-badge {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    padding: 4px 10px;
    background: #f2f2f2;
    border-radius: 999px;
    font-size: 12px;
    font-weight: 600;
    color: #424242;
    letter-spacing: 0.08em;
    text-transform: uppercase;
}

.admin-subnav {
    background: #ffffff;
    border-bottom: 1px solid #f2f2f2;
}

.subnav-container {
    max-width: 1192px;
    margin: 0 auto;
    display: flex;
    justify-content: flex-start;
    gap: 16px;
    padding: 8px 20px;
}

.subnav-link {
    font-size: 13px;
    color: #6b6b6b;
    text-decoration: none;
    padding: 6px 10px;
    border-radius: 999px;
    transition: background 0.2s ease, color 0.2s ease;
}

.subnav-link:hover {
    background: #f2f2f2;
    color: #242424;
}

.subnav-link.active {
    background: #242424;
    color: #ffffff;
}

/* Main Content */
.admin-main {
    max-width: 1192px;
    margin: 0 auto;
    padding: 0 20px;
}

.admin-container {
    max-width: 1000px;
    margin: 0 auto;
    padding-top: 56px;
    min-height: calc(100vh - 200px);
}

/* Header - Blog style */
.admin-header {
    margin-bottom: 48px;
    text-align: left;
}

.admin-title {
    font-size: 42px;
    line-height: 52px;
    letter-spacing: -0.011em;
    font-weight: 700;
    color: #242424;
    margin: 0 0 16px 0;
}

.admin-subtitle {
    font-size: 20px;
    line-height: 28px;
    color: #6B6B6B;
    margin: 0;
}

/* Content Cards */
.content-card {
    background: white;
    border-radius: 8px;
    padding: 32px;
    border: 1px solid #F2F2F2;
    margin-bottom: 32px;
    transition: transform 0.2s ease, box-shadow 0.2s ease;
}

.content-card:hover {
    transform: translateY(-2px);
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
}

.card-header-custom {
    display: flex;
    justify-content: between;
    align-items: center;
    margin-bottom: 24px;
    padding-bottom: 16px;
    border-bottom: 1px solid #F2F2F2;
}

.card-title-custom {
    font-size: 24px;
    line-height: 32px;
    font-weight: 600;
    color: #242424;
    margin: 0;
}

.card-subtitle-custom {
    font-size: 16px;
    color: #6B6B6B;
    margin: 0;
}

/* Buttons - Blog style */
.btn-primary-custom {
    background: #242424;
    color: white;
    border: 1px solid #242424;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-primary-custom:hover {
    background: #1a1a1a;
    color: white;
    text-decoration: none;
    transform: translateY(-1px);
}

.btn-secondary-custom {
    background: #F2F2F2;
    color: #242424;
    border: 1px solid #F2F2F2;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-secondary-custom:hover {
    background: #242424;
    color: white;
    text-decoration: none;
    transform: translateY(-1px);
}

.btn-danger-custom {
    background: #dc3545;
    color: white;
    border: 1px solid #dc3545;
    padding: 12px 24px;
    border-radius: 8px;
    font-size: 14px;
    font-weight: 500;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 8px;
    transition: all 0.2s ease;
}

.btn-danger-custom:hover {
    background: #c82333;
    color: white;
    text-decoration: none;
    transform: translateY(-1px);
}

/* Form Elements */
.form-control-custom {
    width: 100%;
    border: 1px solid #F2F2F2;
    border-radius: 8px;
    padding: 12px 16px;
    font-size: 14px;
    font-family: inherit;
    background: white;
    transition: border-color 0.2s ease;
    box-sizing: border-box;
}

.form-control-custom:focus {
    border-color: #242424;
    outline: none;
    box-shadow: 0 0 0 3px rgba(36, 36, 36, 0.1);
}

.form-label-custom {
    font-size: 14px;
    font-weight: 500;
    color: #242424;
    margin-bottom: 8px;
    display: block;
}

.form-text-custom {
    font-size: 12px;
    color: #6B6B6B;
    margin-top: 4px;
}

/* Tables */
.table-custom {
    width: 100%;
    border-collapse: collapse;
    background: white;
}

.table-custom th {
    background: #F2F2F2;
    padding: 16px;
    text-align: left;
    font-size: 14px;
    font-weight: 500;
    color: #242424;
    border-bottom: 1px solid #F2F2F2;
}

.table-custom td {
    padding: 16px;
    border-bottom: 1px solid #F2F2F2;
    font-size: 14px;
    color: #242424;
}

.table-custom tr:hover {
    background: #fafafa;
}

/* Badges */
.badge-custom {
    padding: 4px 12px;
    border-radius: 16px;
    font-size: 12px;
    font-weight: 500;
    white-space: nowrap;
}

.badge-success { background: #E8F5E8; color: #2D7D32; }
.badge-warning { background: #FFF3E0; color: #F57C00; }
.badge-danger { background: #FFEBEE; color: #D32F2F; }
.badge-info { background: #E3F2FD; color: #1976D2; }
.badge-secondary { background: #F2F2F2; color: #242424; }

/* Quick Actions */
.quick-actions {
    display: flex;
    gap: 8px;
    align-items: center;
}

.quick-actions .btn {
    padding: 8px 12px;
    font-size: 12px;
    border-radius: 6px;
    border: 1px solid #F2F2F2;
    background: white;
    color: #6B6B6B;
    text-decoration: none;
    transition: all 0.2s ease;
}

.quick-actions .btn:hover {
    background: #242424;
    color: white;
    border-color: #242424;
    text-decoration: none;
}

/* Filters */
.filters-section {
    background: white;
    border-radius: 8px;
    padding: 24px;
    border: 1px solid #F2F2F2;
    margin-bottom: 32px;
}

.filters-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 16px;
    align-items: end;
}

/* Pagination */
.pagination-custom {
    display: flex;
    justify-content: center;
    gap: 8px;
    margin-top: 32px;
}

.pagination-custom .page-link {
    padding: 8px 16px;
    border: 1px solid #F2F2F2;
    background: white;
    color: #242424;
    text-decoration: none;
    border-radius: 6px;
    font-size: 14px;
    transition: all 0.2s ease;
}

.pagination-custom .page-link:hover {
    background: #242424;
    color: white;
    border-color: #242424;
}

.pagination-custom .page-link.active {
    background: #242424;
    color: white;
    border-color: #242424;
}

/* Empty State */
.empty-state {
    text-align: center;
    padding: 64px 32px;
    color: #6B6B6B;
}

.empty-state i {
    font-size: 48px;
    margin-bottom: 16px;
    opacity: 0.5;
}

.empty-state h3 {
    font-size: 20px;
    font-weight: 600;
    color: #242424;
    margin-bottom: 8px;
}

.empty-state p {
    font-size: 16px;
    margin: 0 0 24px 0;
}

/* Toast Messages */
@keyframes slideIn {
    from {
        transform: translateX(400px);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

@keyframes slideOut {
    from {
        transform: translateX(0);
        opacity: 1;
    }
    to {
        transform: translateX(400px);
        opacity: 0;
    }
}

.toast-message {
    animation: slideIn 0.3s ease;
}

.toast-message.hiding {
    animation: slideOut 0.3s ease;
}

/* Messages */
.alert-custom {
    padding: 16px 20px;
    border-radius: 8px;
    margin-bottom: 24px;
    border: 1px solid;
    font-size: 14px;
}

.alert-success {
    background: #E8F5E8;
    color: #2D7D32;
    border-color: #C8E6C9;
}

.alert-danger {
    background: #FFEBEE;
    color: #D32F2F;
    border-color: #FFCDD2;
}

.alert-warning {
    background: #FFF3E0;
    color: #F57C00;
    border-color: #FFE0B2;
}

.alert-info {
    background: #E3F2FD;
    color: #1976D2;
    border-color: #BBDEFB;
}

/* Responsive */
@media (max-width: 768px) {
    .admin-main {
        padding: 0 16px;
    }

    .admin-container {
        padding-top: 32px;
    }

    .admin-title {
        font-size: 32px;
        line-height: 40px;
    }

    .content-card {
        padding: 24px;
    }

    .filters-grid {
        grid-template-columns: 1fr;
    }

    .quick-actions {
        flex-direction: column;
        gap: 4px;
    }
}

@media (max-width: 480px) {
    .nav-container {
        padding: 0 16px;
    }

    .content-card {
        padding: 20px;
    }
}
</style>
{% endblock %}

{% block content %}
<div class="admin-page">
    <!-- Top Navigation -->
    <nav class="admin-top-nav">
        <div class="nav-container">
            <div class="nav-left">
                <a href="{% url 'portfolio:admin-dashboard' %}" class="nav-link">{% trans "Dashboard" %}</a>
                {% if site_config %}
                <span class="lang-badge">{{ site_config.default_language|default:LANGUAGE_CODE|upper }}</span>
                {% endif %}
            </div>
            <div class="nav-right">
                {% with current_name=request.resolver_match.url_name|default:'' %}
                <a href="{% url 'portfolio:admin-blog-list' %}" class="nav-link {% if 'project-' in current_name or 'blog' in current_name %}active{% endif %}">{% trans "Context" %}</a>
                <a href="{% url 'portfolio:admin-category-list' %}" class="nav-link {% if 'category' in request.resolver_match.url_name or 'projecttype' in request.resolver_match.url_name or 'knowledge' in request.resolver_match.url_name %}active{% endif %}">{% trans "Catalogs" %}</a>
                <a href="{% url 'portfolio:admin-contact-list' %}" class="nav-link {% if 'contact' in request.resolver_match.url_name %}active{% endif %}">{% trans "Inbox" %}</a>
                <a href="{% url 'portfolio:admin-profile-edit' %}" class="nav-link {% if request.resolver_match.url_name == 'admin-profile-edit' %}active{% endif %}">{% trans "Profile" %}</a>
                <a href="{% url 'portfolio:admin-cv-hub' %}" class="nav-link {% if 'cv' in request.resolver_match.url_name or 'experience' in request.resolver_match.url_name or 'education' in request.resolver_match.url_name or 'skill' in request.resolver_match.url_name %}active{% endif %}">{% trans "CV" %}</a>
                <a href="{% url 'portfolio:admin-analytics' %}" class="nav-link {% if request.resolver_match.url_name == 'admin-analytics' %}active{% endif %}">{% trans "Analytics" %}</a>
                <a href="{% url 'portfolio:admin-site-configuration' %}" class="nav-link {% if request.resolver_match.url_name == 'admin-site-configuration' %}active{% endif %}">{% trans "Settings" %}</a>
                <a href="{% url 'portfolio:home' %}" class="nav-link" target="_blank">{% trans "View Site" %}</a>
                {% endwith %}
            </div>
        </div>
    </nav>
    {% with url_name=request.resolver_match.url_name %}
    {% if url_name %}
        {% if 'project-' in url_name or 'blog' in url_name %}
        <div class="admin-subnav">
            <div class="subnav-container">
                <a href="{% url 'portfolio:admin-blog-list' %}" class="subnav-link {% if 'blog' in url_name %}active{% endif %}">{% trans "Blog Posts" %}</a>
                <a href="{% url 'portfolio:admin-project-list' %}" class="subnav-link {% if 'project' in url_name %}active{% endif %}">{% trans "Projects" %}</a>
            </div>
        </div>
        {% elif 'category' in url_name or 'projecttype' in url_name or 'knowledge' in url_name %}
        <div class="admin-subnav">
            <div class="subnav-container">
                <a href="{% url 'portfolio:admin-category-list' %}" class="subnav-link {% if 'category' in url_name %}active{% endif %}">{% trans "Categories" %}</a>
                <a href="{% url 'portfolio:admin-projecttype-list' %}" class="subnav-link {% if 'projecttype' in url_name %}active{% endif %}">{% trans "Project Types" %}</a>
                <a href="{% url 'portfolio:admin-knowledgebase-list' %}" class="subnav-link {% if 'knowledge' in url_name %}active{% endif %}">{% trans "Knowledge Bases" %}</a>
            </div>
        </div>
        {% endif %}
    {% endif %}
    {% endwith %}

    <!-- Main Content -->
    <main class="admin-main">
        <div class="admin-container">
            <!-- Page Header -->
            <header class="admin-header">
                <h1 class="admin-title">{% block admin_title %}{% trans "Administration" %}{% endblock %}</h1>
                <p class="admin-subtitle">{% block admin_subtitle %}{% trans "Manage your content" %}{% endblock %}</p>
                <div style="margin-top: 24px;">
                    {% block admin_actions %}{% endblock %}
                </div>
            </header>

            <!-- Toast Messages (compact notifications) -->
            {% if messages %}
            <div id="toast-container" style="position: fixed; top: 80px; right: 20px; z-index: 9999; display: flex; flex-direction: column; gap: 12px; max-width: 400px;">
                {% for message in messages %}
                <div class="toast-message toast-{{ message.tags }}" style="background: white; padding: 12px 16px; border-radius: 8px; box-shadow: 0 4px 12px rgba(0,0,0,0.15); border-left: 4px solid {% if message.tags == 'success' %}#4CAF50{% elif message.tags == 'error' %}#dc3545{% elif message.tags == 'warning' %}#FF9800{% else %}#1976D2{% endif %}; display: flex; align-items: center; gap: 12px; animation: slideIn 0.3s ease;">
                    <i class="fas {% if message.tags == 'success' %}fa-check-circle{% elif message.tags == 'error' %}fa-exclamation-circle{% elif message.tags == 'warning' %}fa-exclamation-triangle{% else %}fa-info-circle{% endif %}" style="color: {% if message.tags == 'success' %}#4CAF50{% elif message.tags == 'error' %}#dc3545{% elif message.tags == 'warning' %}#FF9800{% else %}#1976D2{% endif %}; font-size: 18px;"></i>
                    <span style="flex: 1; font-size: 14px; color: #242424;">{{ message }}</span>
                    <button type="button" class="close-toast" onclick="this.parentElement.remove()" style="background: none; border: none; color: #6B6B6B; cursor: pointer; font-size: 18px; padding: 0; line-height: 1;">×</button>
                </div>
                {% endfor %}
            </div>
            {% endif %}

            {% block admin_content %}{% endblock %}
        </div>
    </main>
</div>
{% endblock %}

{% block extra_js %}
<script>
// CSRF token for AJAX requests
function getCookie(name) {
    let cookieValue = null;
    if (document.cookie && document.cookie !== '') {
        const cookies = document.cookie.split(';');
        for (let i = 0; i < cookies.length; i++) {
            const cookie = cookies[i].trim();
            if (cookie.substring(0, name.length + 1) === (name + '=')) {
                cookieValue = decodeURIComponent(cookie.substring(name.length + 1));
                break;
            }
        }
    }
    return cookieValue;
}

const csrftoken = getCookie('csrftoken');

// Quick toggle functions
function quickToggle(url, data, successCallback) {
    fetch(url, {
        method: 'POST',
        headers: {
            'Content-Type': 'application/x-www-form-urlencoded',
            'X-CSRFToken': csrftoken,
        },
        body: new URLSearchParams(data)
    })
    .then(response => response.json())
    .then(data => {
        if (data.success) {
            successCallback(data);
        } else {
            alert('Error: ' + data.message);
        }
    })
    .catch(error => {
        console.error('Error:', error);
        alert('{% trans "Connection error" %}');
    });
}

// Auto-hide toast messages after 5 seconds
setTimeout(function() {
    const toasts = document.querySelectorAll('.toast-message');
    toasts.forEach(toast => {
        toast.classList.add('hiding');
        setTimeout(() => toast.remove(), 300);
    });
}, 5000);
</script>
{% endblock %}
